[![Review Assignment Due Date](https://classroom.github.com/assets/deadline-readme-button-22041afd0340ce965d47ae6ef1cefeee28c7c493a6346c4f15d667ab976d596c.svg)](https://classroom.github.com/a/cZnpr7Ns)
# E4040 2024 Fall Project
## Deep Cluster
This code implements the unsupervised training of convolutional neural networks, as described in the report [E4040.2024Fall.SZQA.report.zs2699.yq2411.jz3849].

Moreover, we provide the evaluation protocol codes we used in the paper:
* Pascal VOC classification
* Linear classification on activations

## Requirements
To run the code in this project, ensure you have the following dependencies installed:

- **Python Installation**  
  Python version 3.7 or later is recommended for compatibility with the libraries used.

- **Required Libraries**  
- [**NumPy**](https://numpy.org/): For numerical computations.
- [**TensorFlow/Keras**](https://www.tensorflow.org/): Version 2.0 or later for deep learning implementations.
- [**Matplotlib**](https://matplotlib.org/): For inline plotting and visualizations.
- [**Scikit-learn**](https://scikit-learn.org/): For clustering (KMeans) and PCA-based dimensionality reduction.
- [**OpenCV (cv2)**](https://opencv.org/): For image processing tasks.

- **GPU Support (Optional)**  
  For training acceleration, ensure you have:
  - CUDA 11.2 or later installed on your system.
  - TensorFlow GPU-compatible version installed.

- **Datasets**  
  - CIFAR-10 dataset, which can be loaded automatically via TensorFlow/Keras datasets.
 
## Pre-trained Models

We provide pre-trained models with MobileNet and custom CNN architectures, available for download. These models are implemented in TensorFlow/Keras format and are compatible with grayscale and RGB input images.

The path of **MobileNet** model:
```
model=/model/mobilenet_cluster_model.h5
```
The path of **Custom CNN** model:
```
model=/model/custom_cluster_model.h5
```
The pre-trained models expect input data with the following preprocessing steps applied:
1. **Grayscale Conversion**  
2. **Normalization**  
3. **Augmentation**

## Running the unsupervised training
Unsupervised training can be launched by running cells in
```
program.ipynb
```
The overvieww of workflow is
```
Load Data -> Feature Extraction -> Clustering -> Pseudo-Supervised Classification -> Save/load Model
```
## Description of key functions of each file in *utils* folder
```
1. Activation.py 
```
Identify and visualize the top N images that activate a specific filter in a convolutional layer of a pre-trained deep learning model, using CIFAR-10 as input data.
```
2. Firstlayer_activation.py 
```
Visualize the responses of all filters in a specified convolutional layer of a pre-trained model using real CIFAR-10 images.
```
3. Firstlayer_directweights.py 
```
Visualizes the filters (weights) of the first convolutional layer in a pre-trained model, displaying them as grayscale images.
```
4. Gradient_ascend.py 
```
Generate, optimize, and visualize activation patterns of a specific filter in a convolutional layer of a pre-trained model using gradient ascent with customizable input.
```
5. Linear_classification.py 
```
Evaluate the representation quality of different layers in a pre-trained MobileNet model by extracting activations, reducing dimensionality with PCA, and training a logistic regression classifier to measure classification accuracy.
```
6. data_processing.py 
```
Perform data preprocessing and augmentation for the CIFAR-10 dataset and visualizes both raw and preprocessed images with their corresponding class labels.
```
7. evaluate.py 
```
Evaluate a trained model's accuracy using true labels and visualizes its predictions compared to the ground truth.
```
8. images folder
```
The images generated by each Python file.

## Figures
The folder to store screenshots for need.

## Organization of this directory
```
.
├── README.md
├── figures
│   ├── gcp_work_example_screenshot_1.png
│   ├── gcp_work_example_screenshot_2.png
│   ├── gcp_work_example_screenshot_3.png
│   └── pipeline.png
├── images
│   └── conv_conv_pw_13_filter_5_top9_grid.png
├── model
│   ├── custom_cluster_model.h5
│   └── mobilenet_cluster_model.h5
├── program.ipynb
└── utils
    ├── Activation.py
    ├── Firstlayer_activation.py
    ├── Firstlayer_directweights.py
    ├── Gradient_ascend.py
    ├── Linear_classification.py
    ├── __pycache__
    │   ├── Activation.cpython-36.pyc
    │   ├── Firstlayer_activation.cpython-36.pyc
    │   ├── Firstlayer_directweights.cpython-36.pyc
    │   ├── Gradient_ascend.cpython-36.pyc
    │   ├── Linear_classification.cpython-36.pyc
    │   ├── data_processing.cpython-36.pyc
    │   └── evaluate.cpython-36.pyc
    ├── data_processing.py
    ├── evaluate.py
    └── images
        ├── conv_conv1_filter_5_top9_grid.png
        ├── conv_conv_pw_13_filter_5_top9_grid.png
        ├── conv_conv_pw_5_filter_5_top9_grid.png
        ├── filter_100_top9_grid.png
        ├── filter_120_top9_grid.png
        ├── filter_140_top9_grid.png
        ├── filter_15_top9_grid.png
        ├── filter_180_top9_grid.png
        ├── filter_190_top9_grid.png
        ├── layer_conv1_allfilters.png
        ├── layer_conv1_allfilters_2.png
        ├── layer_conv1_allfilters_noactivate.png
        ├── layer_conv1_filter_5_GA.png
        ├── layer_conv_pw_11_filter_5_GA.png
        ├── layer_conv_pw_13_filter_5_GA.png
        ├── layer_conv_pw_3_filter_5_GA.png
        ├── layer_conv_pw_5_filter_5_GA.png
        ├── layer_conv_pw_7_filter_5_GA.png
        └── layer_conv_pw_9_filter_5_GA.png

6 directories, 42 files
```
